var AirPlane;!function(t){var e=function(e){function i(){e.call(this),this.rowCount=1,this.speed=10,this.plottingScale=10,this.totalTimes=0,this.totalDistance=0,this.bgCount=0,this.bgArr=[],this.itemsArray=[],this.nameValueDictionary=[],this.itemsInfo=t.GameUtil.getSpriteSheetData("itemsV1","itemsV2","itemsV3","itemsV4","itemsV5","itemsV6","itemsV7","itemsV8"),this.mainInfo=t.GameUtil.getSpriteSheetData("main"),this.isWin=!1,this.currentIndex=0,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),t.debuggerCheck("测试444444",this,function(){})}__extends(i,e);var n=(__define,i);return p=n.prototype,p.setScaleX=function(e){e.scaleX=t.computScaleRate(e.texture.textureWidth,this.stageW)},p.onAddToStage=function(e){var i=this,n=this;this.itemsArray=this.itemsInfo.getBitmapModels(),this.itemsArray.forEach(function(t){var e=i.getNameRule(t.textureName);e&&(i.nameValueDictionary[e]||(i.nameValueDictionary[e]=[]),i.nameValueDictionary[e].push(t))});var s=RES;this.groupDic=s.configInstance.groupDic.backgrounds,this.bgArr=[],this.groupDic.forEach(function(e){n.bgArr.push(new t.BitmapModel(null,e.name))}),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.reset()},p.createBgBmp=function(e){var i=t.createBitmapByName(e);return new t.BitmapModel(i,e)},p.getNameRule=function(t){var e,i=t.split("_");return i.length>3?e=i[1]+"$"+i[2]+"$"+i[3]:""},p.checkWin=function(){if(this.bgCount>=this.bgArr.length){var t=this.bmpDataArr[this.bmpDataArr.length-1];if(t.bitmap.y>=0)return!0}return!1},p.getItemName=function(){this.currentIndex++;var t=this.getCurrentBgName().originName,e=this.getNameRule(t);if(t){var i=this.nameValueDictionary[e];if(i)return i[Math.floor(Math.random()*i.length)].textureName}return this.itemsArray[Math.floor(Math.random()*this.itemsArray.length)].textureName},p.start=function(){this.reset()},p.reset=function(){this.isWin=!1,this.currentIndex=0,this.totalDistance=0,this.totalTimes=0,this.bgCount=0,this.bmpDataArr=[],this.removeChildren();for(var t=0;t<this.rowCount;t++){var e=this.createBgBmp(this.bgArr[t].textureName),i=e.bitmap;this.bgCount++;var n=0==this.bmpDataArr.length?this.stageH:this.bmpDataArr[this.bmpDataArr.length-1].bitmap.y;i.y=n-i.texture.textureHeight,this.bmpDataArr.push(e),this.setScaleX(i),this.addChild(i)}},p.enterFrameHandler=function(e){this.totalDistance=this.plottingScale*++this.totalTimes;for(var i=0;i<this.bmpDataArr.length;i++){if(this.bmpDataArr.length>i){var n=this.bmpDataArr[i];if(n.bitmap.y+=this.speed,n.bitmap.y>=0&&"end"!=n.status&&(n.status="end",this.bgArr.length>this.bgCount)){var s=this.createBgBmp(this.bgArr[this.bgCount].textureName);s.bitmap.y=0-s.bitmap.texture.textureHeight,this.setScaleX(s.bitmap),this.addChild(s.bitmap),this.bmpDataArr.push(s),this.bgCount++}n.bitmap&&n.bitmap.y>this.stageH&&(t.clearSprite(n.bitmap),this.bmpDataArr.shift(),n=null)}this.isWin=this.checkWin()}},p.getCurrentBgName=function(){var t=this.bmpDataArr[0],e=t.textureName.split("_");return{chauName:e[1],countryName:e[2],cityName:e[3],originName:t.textureName}},p.pause=function(){},i}(egret.DisplayObjectContainer);t.BgMap=e,egret.registerClass(e,"AirPlane.BgMap")}(AirPlane||(AirPlane={}));var AirPlane;!function(t){var e=function(t){function e(){t.call(this),this.rectangle=new egret.Shape,this.rectangle.graphics.beginFill(3407616,1),this.rectangle.graphics.drawRect(0,0,100,6e4),this.rectangle.graphics.endFill(),this.addChild(this.rectangle)}__extends(e,t);var i=(__define,e);return p=i.prototype,e}(egret.Sprite);t.BgPanel=e,egret.registerClass(e,"AirPlane.BgPanel")}(AirPlane||(AirPlane={}));var AirPlane;!function(t){var e=function(e){function i(t){e.call(this,t),this.isDie=!1}__extends(i,e);var n=(__define,i);return p=n.prototype,i.produce=function(e){null==t.Enemy.cacheDict[e]&&(t.Enemy.cacheDict[e]=[]);var i,n=t.Enemy.cacheDict[e];return i=n.length>0?n.pop():new t.Enemy(RES.getRes(e)),i.textureName=e,i},i.reclaim=function(e,i){null==t.Enemy.cacheDict[i]&&(t.Enemy.cacheDict[i]=[]);var n=t.Enemy.cacheDict[i];-1==n.indexOf(e)&&n.push(e)},i.cacheDict={},i}(egret.Bitmap);t.Enemy=e,egret.registerClass(e,"AirPlane.Enemy")}(AirPlane||(AirPlane={}));var AirPlane;!function(t){var e=function(e){function i(){e.call(this),this.enemys=[],this.myScore=0,this.itemsInfo=t.GameUtil.getSpriteSheetData("items"),this.mainInfo=t.GameUtil.getSpriteSheetData("main"),this.backgroundsInfo=t.GameUtil.getSpriteSheetData("backgrounds-1","backgrounds-2","backgrounds-3"),this.enemyTimer=new egret.Timer(500),this.timeLeft=100,this.timeDelay=1e3,this.timeCount=30,this.downTimes=6,this.playerSpeed=10,this.addTimeCount=3,this.currentTimeCount=0,this.managerInstance=t.createSoundManager(),this.currentPlane=null,this.baopos=[],this.c_init=!1,this.trunLeft=!1,this.trunRight=!1,this.degRange=8,this._lastTime=egret.getTimer(),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(i,e);var n=(__define,i);return p=n.prototype,p.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.createGameScene()},p.createGameScene=function(){this.managerInstance("bgSound").play(0,-1).setVolume(.3),this.bg=new t.BgMap,this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.bg.width=this.stageW,this.bg.height=this.stageH,this.addChild(this.bg),this.scorePanel=new t.ScorePanel,this.scorePanel.x=(this.stageW-this.scorePanel.width)/2,this.scorePanel.y=50,this.preCreatedInstance()},p.getBigPlane=function(){var t=this;return t.bigPlane||(t.bigPlane=[],t.bigPlane.push(this.mainInfo.getImage("airplaneLeft")),t.bigPlane.push(this.mainInfo.getImage("airplane")),t.bigPlane.push(this.mainInfo.getImage("airplaneRight")),t.currentPlane=this.bigPlane[1]),{"switch":function(e){var i=t.bigPlane[e];return i!==t.currentPlane&&(i.x=t.currentPlane.x,i.y=t.currentPlane.y,t.clearSprite(t.currentPlane),t.addChild(i)),t.currentPlane=i},left:function(){return this["switch"](0)},normal:function(){return this["switch"](1)},right:function(){return this["switch"](2)},current:function(){return t.currentPlane}}},p.preCreatedInstance=function(){for(var e=0;e<this.bg.itemsArray.length;e++)for(var i=0;1>i;i++){var n=t.Enemy.produce(this.bg.itemsArray[e].textureName);t.Enemy.reclaim(n,this.bg.itemsArray[e].textureName)}for(var e=0;10>e;e++)this.createBaoPo(0,0,!0)},p.createBaoPo=function(t,e,i){var n=null;n=this.baopos.length>0?this.baopos.pop():this.mainInfo.getImage("baopo");n.scaleX=n.scaleY=.5,n.x=t,n.y=e,n.alpha=.3,i?this.baopos.push(n):(this.addChildAt(n,100),egret.Tween.get(n).to({scaleX:1,scaleY:1,alpha:1},600).call(function(t){this.clearSprite(t),this.baopos.push(t)},this,[n]))},p.gameViewUpdate=function(t){this.bg.enterFrameHandler(t);var e=egret.getTimer(),i=1e3/(e-this._lastTime);this._lastTime=e;var n,s=60/i,r=0,a=[],h=this.enemys.length;for(r=0;h>r;r++)n=this.enemys[r],n.y+=this.downTimes*s,n.y>this.stageH&&a.push(n);var o=0,m=null;this.trunLeft?(m=this.getBigPlane().left(),m.x-=this.playerSpeed):this.trunRight?(m=this.getBigPlane().right(),m.x+=this.playerSpeed):m=this.getBigPlane().normal(),o=this.getBigPlane().current().x+o,o=Math.max(0,o),o=Math.min(this.stageW-m.width,o),m.x=o,this.scorePanel.showScore(this.bg.getCurrentBgName().countryName+"  "+this.bg.getCurrentBgName().cityName,this.bg.totalDistance),this.reclaimEnemy(a),this.gameHitTest(),this.bg.isWin&&this.gameSucc()},p.reclaimEnemy=function(e){for(var i=0;i<e.length;i++){var n=e[i];this.clearSprite(n),n.isDie=!1,t.Enemy.reclaim(n,n.textureName),this.enemys.splice(this.enemys.indexOf(n),1)}},p.gameHitTest=function(){for(var e,i=this.enemys.length,n=0;i>n;n++)if(e=this.enemys[n],e&&!e.isDie&&t.GameUtil.hitTest(this.getBigPlane().current(),e,{x:-40,y:-40})){if(e.isDie=!0,this.createBaoPo(e.x-40,e.y-40),this.showLog("碰撞命中"),this.currentTimeCount++,this.currentTimeCount>=this.addTimeCount){this.currentTimeCount=0;var s=this.gameTimer.repeatCount-this.gameTimer.currentCount+1;s=s>this.timeCount?this.timeCount:s,this.gameTimerReset(s)}this.reclaimEnemy([e])}},p.showLog=function(t){},p.touchHandler=function(t){},p.gameStart=function(){this.whenGameStart&&this.whenGameStart(this),this.managerInstance("bgSound").stop().play(0,-1).setVolume(.3),this.clearSprite(this.icon),this.animateShow(),this.bg.start(),this.touchEnabled=!0,this.addEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchHandler,this),this.gameTimerStart(),this.scorePanel.reset(),this.clearSprite(this.scorePanel),this.addChildAt(this.scorePanel,100),this.startGravitySensor()},p.gameTimerStart=function(){this.timelinebg=this.mainInfo.getImage("timelinebg"),this.timelinebg.x=this.stageW-this.timelinebg.width-10,this.timelinebg.y=50,this.addChild(this.timelinebg),this.timeline=this.mainInfo.getImage("timeline"),this.timeline.x=this.stageW-this.timeline.width-13,this.timeline.y=54,this.addChild(this.timeline),this.timelinemask=new egret.Rectangle(0,0,this.timeline.width,this.timeline.height),this.timeline.mask=this.timelinemask,this.gameTimerReset(this.timeCount,!0),this.enemyTimer.addEventListener(egret.TimerEvent.TIMER,this.createEnemy,this),this.enemyTimer.start()},p.gameTimerReset=function(t,e){e||(this.gameTimer.stop(),this.gameTimer.removeEventListener(egret.TimerEvent.TIMER,this.timelineDown,this),this.gameTimer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.gameSucc,this)),this.gameTimer=new egret.Timer(this.timeDelay,t),this.gameTimer.addEventListener(egret.TimerEvent.TIMER,this.timelineDown,this),this.gameTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.gameSucc,this),this.timelineDown(),this.gameTimer.start()},p.gameSucc=function(){this.gameStop(),this.whenGameStop&&this.whenGameStop(this,!0);for(var e;this.enemys.length>0;)e=this.enemys.pop(),this.clearSprite(e),t.Enemy.reclaim(e,"enemyImage")},p.gameStop=function(){this.showLog("游戏停止了 gameStop"),this.bg.pause(),this.removeEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchHandler,this),this.enemyTimer&&this.enemyTimer.removeEventListener(egret.TimerEvent.TIMER,this.createEnemy,this),this.enemyTimer&&this.enemyTimer.stop(),this.gameTimer&&this.gameTimer.removeEventListener(egret.TimerEvent.TIMER,this.timelineDown,this),this.gameTimer&&this.gameTimer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.gameSucc,this),this.gameTimer&&this.gameTimer.stop(),this.stopGravitySensor(),this.clearSprite(this.timeline),this.clearSprite(this.timelinebg),this.clearSprite(this.getBigPlane().current())},p.gameOver=function(){this.gameStop(),this.whenGameStop&&this.whenGameStop(this,!1);for(var e;this.enemys.length>0;)e=this.enemys.pop(),this.clearSprite(e),t.Enemy.reclaim(e,e.textureName);this.replay=this.mainInfo.getImage("replayBtn"),this.replay.anchorOffsetX=this.replay.anchorOffsetY=50,this.replay.x=this.stageW/2+100,this.replay.y=this.stageH-100,this.replay.touchEnabled=!0,this.replay.addEventListener(egret.TouchEvent.TOUCH_TAP,this.gameReplay,this),this.addChild(this.replay)},p.timelineDown=function(t){this.timelinemask.y=(this.timeCount-(this.gameTimer.repeatCount-this.gameTimer.currentCount))/this.timeCount*this.timeline.height,this.timeline.mask=this.timelinemask},p.createEnemy=function(e){var i=t.Enemy.produce(this.bg.getItemName());i.x=Math.random()*(this.stageW-i.width),i.y=-i.height-300*Math.random(),this.addChildAt(i,this.numChildren-1),this.enemys.push(i)},p.gameReplay=function(){this.gameStop(),this.clearSprite(this.replay),this.clearSprite(this.scorePanel),this.gameStart()},p.getGameFinalData=function(){var t=this.bg.getCurrentBgName(),e=this;return{station:e.bg.bgCount,point:e.bg.totalDistance,country:t.countryName,city:t.cityName}},p.clearSprite=function(t){t&&t.parent&&t.parent.removeChild(t)},p.animateShow=function(){var t=this.getBigPlane().current();t.x=(this.stageW-t.width)/2,t.y=this.stageH-t.height-50,this.addChild(t)},p.startGravitySensor=function(){this.trunLeft=!1,this.trunRight=!1,egret.setTimeout(function(){this.c_init=!1,this.orientation=new egret.DeviceOrientation,this.orientation.addEventListener(egret.Event.CHANGE,this.onOrientation,this),this.orientation.start()},this,600)},p.stopGravitySensor=function(){this.orientation&&(this.orientation.removeEventListener(egret.Event.CHANGE,this.onOrientation,this),this.orientation.stop())},p.onOrientation=function(t){this.c_init||(this.c_alpha=t.alpha,this.c_beta=t.beta,this.c_gamma=0,this.c_init=!0);var e=t.gamma-this.c_gamma;Math.abs(t.gamma-this.c_gamma)>this.degRange?e>0?(this.trunLeft=!1,this.trunRight=!0):(this.trunLeft=!0,this.trunRight=!1):(this.trunLeft=!1,this.trunRight=!1)},i}(egret.DisplayObjectContainer);t.GameContainer=e,egret.registerClass(e,"AirPlane.GameContainer")}(AirPlane||(AirPlane={}));var AirPlane;!function(t){function e(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e}function i(t){t&&t.parent&&t.parent.removeChild(t)}function n(t,e){return e/t}function s(t,e,i){}function r(){var t={};return function(e){if(!t[e]){t[e]={};var i=RES.getRes(e);t[e].sound=i}var n=t[e];return{play:function(t,e){var i=n.sound.play(t||0,e||1);return n.channel=i,this},stop:function(){return n&&n.channel&&n.channel.stop(),this},setVolume:function(t){return n&&n.channel&&(n.channel.volume=t),this}}}}var a=function(){function e(){}var i=(__define,e);return p=i.prototype,e.hitTest=function(t,e,i){var n=t.getBounds(),s=e.getBounds();if(n.x=t.x,n.y=t.y,s.x=e.x,s.y=e.y,i){var r=n;(i.type=2)&&(r=s),r.offset(i.x,i.y)}return n.intersects(s)},e.hitTestP=function(t,e){var i,n;return i=e.x+e.width/2,n=e.y+e.height/2,t.hitTestPoint(i,n)},e.getSpriteSheetData=function(){for(var e=this,i=[],n=0;n<arguments.length;n++)i[n-0]=arguments[n];var s=this,r=[];return i.forEach(function(t){s.sheetDictionary[t]||(s.sheetDictionary[t]={},s.sheetDictionary[t].textureSheet=RES.getRes(t)),r.push(e.sheetDictionary[t].textureSheet)}),{getImage:function(t){var e=null;return r.forEach(function(i){i.getTexture(t)&&(e=new egret.Bitmap,e.texture=i.getTexture(t))}),e},getSheets:function(){return r},getBitmapModels:function(){var e=this,n=[];return i.forEach(function(i,a){if(s.sheetDictionary[i]&&!s.sheetDictionary[i].bitmapModels){s.sheetDictionary[i].bitmapModels=[];var h=r[a]._textureMap;for(var o in h)h.hasOwnProperty(o)&&s.sheetDictionary[i].bitmapModels.push(new t.BitmapModel(e.getImage(o),o))}n=n.concat(s.sheetDictionary[i].bitmapModels)}),n},sheetNames:i}},e.sheetDictionary={},e}();t.GameUtil=a,egret.registerClass(a,"AirPlane.GameUtil"),t.createBitmapByName=e,t.clearSprite=i,t.computScaleRate=n,t.debuggerCheck=s,t.createSoundManager=r;var h=function(){function t(t,e,i){this.bitmap=t,this.textureName=e,this.status=i}var e=(__define,t);return p=e.prototype,t}();t.BitmapModel=h,egret.registerClass(h,"AirPlane.BitmapModel")}(AirPlane||(AirPlane={}));var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e);return p=i.prototype,p.createView=function(){this.textField=new egret.TextField,this.textField.textColor=3329330,this.textField.bold=!0,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},p.setProgress=function(t,e){this.textField.text="Loading..."+Math.floor(100*t/+e)+"%"},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.call(this),this.totalCount=0,this.itemsLoaded=0,this.loadedConifigs=[],this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e);return p=i.prototype,p.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},p.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceError,this),RES.loadGroup("preload"),RES.loadGroup("backgrounds");var e=RES;this.totalCount+=e.configInstance.groupDic.backgrounds.length,this.totalCount+=e.configInstance.groupDic.preload.length},p.onResourceError=function(t){},p.onResourceLoadComplete=function(t){this.loadedConifigs.push(t.groupName),this.loadedConifigs.indexOf("preload",0)>=0&&this.loadedConifigs.indexOf("backgrounds",0)>=0&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.gameContainer=new AirPlane.GameContainer,this.addChild(this.gameContainer),this.whenLoadComplete&&this.whenLoadComplete(this))},p.onResourceProgress=function(t){("preload"==t.groupName||"backgrounds"==t.groupName)&&(this.itemsLoaded++,this.loadingView.setProgress(this.itemsLoaded,this.totalCount))},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var AirPlane;!function(t){var e=function(e){function i(){e.call(this),this.txt=new egret.TextField,this.score=new egret.TextField,this.mainInfo=t.GameUtil.getSpriteSheetData("main"),this.background=this.mainInfo.getImage("scoreTip"),this.addChild(this.background),this.txt.width=250,this.txt.height=100,this.txt.textAlign="center",this.txt.textColor=16777215,this.txt.size=24,this.txt.bold=!0,this.txt.y=20,this.txt.x=10,this.addChild(this.txt),this.score.width=150,this.score.height=100,this.score.textAlign="left",this.score.textColor=16777215,this.score.size=24,this.score.bold=!0,this.score.y=20,this.score.x=260,this.addChild(this.score),this.touchChildren=!1,this.touchEnabled=!1}__extends(i,e);var n=(__define,i);return p=n.prototype,p.showScore=function(t,e){this.score.text=e+"km",this.txt.text=t},p.reset=function(){this.score.text="km",this.txt.text=""},i}(egret.Sprite);t.ScorePanel=e,egret.registerClass(e,"AirPlane.ScorePanel")}(AirPlane||(AirPlane={}));